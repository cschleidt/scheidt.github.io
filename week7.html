<!DOCTYPE html>
<html lang="en">
    <head>
         <style type="text/css">
            
			
			div.centre
            {
				width: 1000px;
				display: block;
				margin-left: auto;
				margin-right: auto;
            }

			div.border
			{
				border: 2px solid lightgray;
			}

			div.tooltip {	
				position: absolute;			
				text-align: center;			
				width: 100px;					
				height: 35px;					
				padding: 2px;				
				font: 10px sans-serif;		
				background: lightsteelblue;	
				border: 0px;		
				border-radius: 8px;			
				pointer-events: none;			
			}
           	.axis path,
			.axis line {
				fill: none;
				stroke: black;
				shape-rendering: crispEdges;
			}
			
			.axis text {
				font-family: sans-serif;
				font-size: 11px;
			}
        </style>
        <meta charset="utf-8">
        <title>SOC Week 6 Exercises</title>
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script type="text/javascript" src="//d3js.org/d3.v3.min.js"></script>
    </head>
    <body>
        <div class='centre'>
			<h1>Visualization 1</h1>
			<p>Scatter plot: combination of vehicle theft and prostitution per year</p>
			<div id="viz1" class='border'></div>

			<p>
			<label for="amount">Ã…r:</label>
			<input type="text" id="amount" readonly style="border:0; color:#f6931f; font-weight:bold;">
			</p>
			<div id="slider-range-max"></div>
        </div>

    </body>

    <script type="text/javascript">

        var thedataset;
        var xScale;
        var yScale;
        var rScale;

        getvizdata();

        function getvizdata()
        {
            d3.csv("week7.csv", function(error, data) {
                console.log(data[0]);

                 data.forEach(function(d) {
                     d.district = d.district;
                     d.prostitution = parseInt(d.prostitution);
                     d.theft = parseInt(d.theft);
                     d.year = parseInt(d.year);
                 });

                thedataset = data;

                var data2003 = data.filter(function (d) {
                    return d.year == 2003
                });
                
                doscatterplot(data2003);
            });
        }

        function doscatterplot(dataset)
        {
			//Width and height
			var w = 1000;
			var h = 600;
			
            var padding = 50;

			//Create scale functions
			//var xScale = d3.scale.linear()
			//		.domain([0, d3.max(dataset, function(d) { return d.prostitution; })])
			//		.range([padding, w - padding * 2]);

			xScale = d3.scale.linear()
				.domain([0, 1000])
				.range([padding, w - padding * 2]);

			//yScale = d3.scale.linear()
			//		.domain([0, d3.max(dataset, function(d) { return d.theft; })])
			//		.range([h - padding , padding]);

			yScale = d3.scale.linear()
				.domain([0, 3000])
				.range([h - padding , padding]);
	
            rScale = d3.scale.linear()
				.domain([0, d3.max(dataset, function(d) { return d.prostitution + d.theft; })])
				.range([2, 8]);

			// Define X axis
            var xAxis = d3.svg.axis()
				.scale(xScale)
				.orient("bottom")
				.ticks(8);

			// Define Y axis
			var yAxis = d3.svg.axis()
				.scale(yScale)
				.orient("left")
				.ticks(7);

			// Define the div for the tooltip
			var div = d3.select("body").append("div")	
    			.attr("class", "tooltip")				
    			.style("opacity", 0);

			//Create SVG element
			var svg = d3.select("#viz1")
						.append("svg")
						.attr("width", w)
						.attr("height", h);

			svg.selectAll("circle")
			   	.data(dataset)
			   	.enter()
			   	.append("circle")
			   	.attr("cx", function(d) {
			   		return xScale(d.prostitution);
			   	})
			   	.attr("cy", function(d) {
			   		return yScale(d.theft);
			   	})
			   	.attr("r", function(d) {
			   		return rScale(d.prostitution + d.theft);
			   	})
        		.on("mouseover", function(d) {		
            		div.transition()		
                		.duration(200)		
                		.style("opacity", .9);		
            	
					div	.html(d.district + "<br/>Prostitution: "  + d.prostitution + "<br/>Theft: "  + d.theft)	
                		.style("left", (d3.event.pageX) + "px")		
                		.style("top", (d3.event.pageY - 28) + "px");	
            	})					
        		.on("mouseout", function(d) {		
            		div.transition()		
                		.duration(500)		
                		.style("opacity", 0) });

			svg.selectAll("text")
			   	.data(dataset)
			   	.enter()
			   	.append("text")
			   	.text(function(d) {
			   		return d.district;
			   	})
			   	.attr("x", function(d) {
			   		return xScale(d.prostitution);
			   	})
			   	.attr("y", function(d) {
			   		return yScale(d.theft) - 10;
			   	})
			   .attr("font-family", "sans-serif")
			   .attr("font-size", "9px")
			   .attr("fill", "lightsteelblue");

            //Create X axis
			svg.append("g")
				    .attr("class", "axis")
				    .attr("transform", "translate(0," + (h - padding) + ")")
				    .call(xAxis) 
                .append("text")
                    .attr("class", "label")
                    .attr("x", w - padding * 2)
                    .attr("y", -6)
                    .style("text-anchor", "end")
                    .text("Prostitution");
			
			//Create Y axis
			svg.append("g")
				.attr("class", "axis")
				.attr("transform", "translate(" + padding + ",0)")
				.call(yAxis)
                .append("text")
                    .attr("class", "label")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 14)
                    .attr("x", -50)
                    //.attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .text("Theft");
        }

        function updateplot(dataset)
        {
            //var placeholder = $("#viz1")
            //var svg = jQuery("svg", placeholder);

            var svg = d3.select("svg")

			svg.selectAll("circle")
			   .data(dataset)
               .transition()
			   .duration(500)
			   .attr("cx", function(d) {
			   		return xScale(d.prostitution);
			   })
			   .attr("cy", function(d) {
			   		return yScale(d.theft);
			   })
			   .attr("r", function(d) {
			   		return rScale(d.prostitution + d.theft);
			   });

			svg.selectAll("text")
			   .data(dataset)
               .transition()
			   .text(function(d) {
			   		return d.district;
			   })
			   .attr("x", function(d) {
			   		return xScale(d.prostitution);
			   })
			   .attr("y", function(d) {
			   		return yScale(d.theft) - 8;
			   })
			   //.attr("font-family", "sans-serif")
			   //.attr("font-size", "9px")
			   //.attr("fill", "lightsteelblue")
			   ;
        }

        $( function() {
            $( "#slider-range-max" ).slider({
            range: "max",
            min: 2003,
            max: 2015,
            value: 2,
            slide: function( event, ui ) {
                $( "#amount" ).val( ui.value );

                //var placeholder = $("#viz1")
                //jQuery("svg", placeholder).remove();

                var datayear = thedataset.filter(function (d) {
                    return d.year == ui.value;
                });
                
                updateplot(datayear);
            }
            });
            $( "#amount" ).val( $( "#slider-range-max" ).slider( "value" ) );
        } );

    </script>    
</html>

<!--
        <script type="text/javascript">
		
			var dataset = [ 5, 10, 15, 20, 25 ];
			
			d3.select("body").selectAll("p")
				.data(dataset)
				.enter()
				.append("p")
				.text(function(d) {
					return "I can count up to " + d;
				})
				.style("color", function(d) {
					if (d > 15) {	//Threshold of 15
						return "red";
					} else {
						return "black";
					}
				});
			
		</script>
-->
<!--
        <script type="text/javascript">
            // Your beautiful D3 code will go here
            var dataset = [ 5, 10, 15, 20, 25 ];

            d3.select("body").selectAll("p")
            .data(dataset)
            .enter()
            .append("p")
            .text(function(d) { return d; });
        </script>
-->        
